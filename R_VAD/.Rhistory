library(grid)
library(magrittr)
library(data.table)
library(zoo)
source("geom_arrow.R")
source("helpfun.R")
source('~/Dropbox/Tesis/tesis-VAD/R_VAD/superficie.R', echo=TRUE)
superficie
View(superficie)
View(vad_20160114)
vad_20160114 <- read.vad("../../20160114_240/vda*")
vad_20160114 <- lowess.vad(vad_20160114)
vad_20160114$date_time <- ymd_hm(vad_20160114$date_time)
vad_20160114 <- read.vad("../../20160114_240/vda*")
vad_20160114 <- lowess.vad(vad_20160114)
ymd_hm(vad_20160114$date_time)
vad_20160114$date_time
vad_20160114$date_time[50]
ymd_hm(vad_20160114$date_time[50])
srt(superficie)
str(superficie)
str(vad_20160114)
round_date(vad_20160114$date_time[50], "mminute")
round_date(vad_20160114$date_time[50], "minute")
vad_20160114$date_time <- round_date(vad_20160114$date_time, "minute")
vad_20160114 <- rbind(superficie, vad_20160114)
ncol(vad_20160114)
ncol(superficie)
vad_20160114 <- read.vad("../../20160114_240/vda*")
library(dplyr)
%<%
vad_20170120 <- read.vad("../../20170120_240/vda*") %<% lowess.vad(vad_20170120)
library(mutate)
vad_20170120 <- read.vad("../../20170120_240/vda*") %>% lowess.vad(vad_20170120)
vad_20170120 <- lowess.vad(vad_20170120)
vad_20160114 <- read.vad("../../20160114_240/vda*")
vad_20160114$date_time <- round_date(vad_20160114$date_time, "minute")
vad_20160114 <- rbind(superficie, vad_20160114)
dia <- vad_20160114
dia <- rbind(vad_20160113, vad_20160114)
perfiles <- subset(dia, ht < 1.5 & minute(date_time) == 00 & hour(date_time) %in% c(0, 6, 12, 18, 23))
tiempos <- subset(dia, minute(date_time) == 0)
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
# geom_contour(data = vad_20160114, aes(z = spd)) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(data = subset(dia, rmse1 > 0.5), aes(size = rmse1), shape = 1, color = "black") +
geom_point(data = subset(dia, rmse2 > 0.5), aes(size = rmse2), shape = 4, color = "grey25") +
ylim(c(0,2)) + xlab("Tiempo") +
ylab("Altura (km)") +
labs(title = paste0("Campo de viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
sup <- read.csv("../../Superficie/parana2016.csv", sep = ";", na.strings = " ")
View(sup)
sup$intensidad <- sup$intensidad * 0.5144 # Paso de nudos a m/s
sup$direccion <- sup$direccion * 10 #Paso del formato synop a angulos entre 0 y 360
sup$ht <- 0.01
ggplot(subset(tiempos, !is.na(spd)), aes(date_time, ht)) +
#geom_arrow(data =  tiempos1, aes(mag = spd, angle = di), color = "red") +
geom_arrow(aes(mag = spd, angle = di, color = spd)) +
geom_point(aes(size = ifelse(rmse1 > 0.5, rmse1, NA)), shape = 1, color = "black") +
geom_point(aes(size = ifelse(rmse2 > 0.5, rmse2, NA)), shape = 4, color = "grey25") +
scale_size_continuous(range = c(0, 5), guide = "none") +
scale_color_distiller(palette = "Oranges", name="Velocidad", direction = 1) +
xlab("Tiempo (hora UTC)") + ylab("Altura (km)") +
ylim(c(0,2)) +
scale_x_datetime(date_breaks = "2 hour", date_labels = "%H z") +
theme(axis.text.x = element_text(angle = 45)) +
labs(title = paste0("Dirección del viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
# geom_contour(data = vad_20160114, aes(z = spd)) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(data = subset(dia, rmse1 > 0.5), aes(size = rmse1), shape = 1, color = "black") +
geom_point(data = subset(dia, rmse2 > 0.5), aes(size = rmse2), shape = 4, color = "grey25") +
ylim(c(0,2)) + xlab("Tiempo") +
ylab("Altura (km)") +
labs(title = paste0("Campo de viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
View(dia)
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
geom_point()+
# geom_contour(data = vad_20160114, aes(z = spd)) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(data = subset(dia, rmse1 > 0.5), aes(size = rmse1), shape = 1, color = "black") +
geom_point(data = subset(dia, rmse2 > 0.5), aes(size = rmse2), shape = 4, color = "grey25") +
ylim(c(0,2)) + xlab("Tiempo") +
ylab("Altura (km)") +
labs(title = paste0("Campo de viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
vad_20160114 <- rbind(subset(superficie, day(date_time) == 14), vad_20160114)
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
geom_point()+
# geom_contour(data = vad_20160114, aes(z = spd)) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(data = subset(dia, rmse1 > 0.5), aes(size = rmse1), shape = 1, color = "black") +
geom_point(data = subset(dia, rmse2 > 0.5), aes(size = rmse2), shape = 4, color = "grey25") +
ylim(c(0,2)) + xlab("Tiempo") +
ylab("Altura (km)") +
labs(title = paste0("Campo de viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
dia <- vad_20160114
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
geom_point()+
# geom_contour(data = vad_20160114, aes(z = spd)) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(data = subset(dia, rmse1 > 0.5), aes(size = rmse1), shape = 1, color = "black") +
geom_point(data = subset(dia, rmse2 > 0.5), aes(size = rmse2), shape = 4, color = "grey25") +
ylim(c(0,2)) + xlab("Tiempo") +
ylab("Altura (km)") +
labs(title = paste0("Campo de viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
vad_20160114 <- read.vad("../../20160114_240/vda*")
vad_20170120 <- read.vad("../../20170120_240/vda*") %>% lowess.vad()
vad_20170120 <- read.vad("../../20170120_240/vda*") %>% lowess.vad(.)
vad_20160114$date_time <- round_date(vad_20160114$date_time, "minute")
vad_20160114 <- rbind(subset(superficie, day(date_time) == 14), vad_20160114)
dia <- vad_20160114
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
geom_point()+
# geom_contour(data = vad_20160114, aes(z = spd)) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(data = subset(dia, rmse1 > 0.5), aes(size = rmse1), shape = 1, color = "black") +
geom_point(data = subset(dia, rmse2 > 0.5), aes(size = rmse2), shape = 4, color = "grey25") +
ylim(c(0,2)) + xlab("Tiempo") +
ylab("Altura (km)") +
labs(title = paste0("Campo de viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
# geom_contour(data = vad_20160114, aes(z = spd)) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(data = subset(dia, rmse1 > 0.5), aes(size = rmse1), shape = 1, color = "black") +
geom_point(data = subset(dia, rmse2 > 0.5), aes(size = rmse2), shape = 4, color = "grey25") +
ylim(c(0,2)) + xlab("Tiempo") +
ylab("Altura (km)") +
labs(title = paste0("Campo de viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
ggplot(subset(tiempos, !is.na(spd)), aes(date_time, ht)) +
#geom_arrow(data =  tiempos1, aes(mag = spd, angle = di), color = "red") +
geom_arrow(aes(mag = spd, angle = di, color = spd)) +
geom_point(aes(size = ifelse(rmse1 > 0.5, rmse1, NA)), shape = 1, color = "black") +
geom_point(aes(size = ifelse(rmse2 > 0.5, rmse2, NA)), shape = 4, color = "grey25") +
scale_size_continuous(range = c(0, 5), guide = "none") +
scale_color_distiller(palette = "Oranges", name="Velocidad", direction = 1) +
xlab("Tiempo (hora UTC)") + ylab("Altura (km)") +
ylim(c(0,2)) +
scale_x_datetime(date_breaks = "2 hour", date_labels = "%H z") +
theme(axis.text.x = element_text(angle = 45)) +
labs(title = paste0("Dirección del viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
perfiles <- subset(dia, ht < 1.5 & minute(date_time) == 00 & hour(date_time) %in% c(0, 6, 12, 18, 23))
tiempos <- subset(dia, minute(date_time) == 0)
ggplot(subset(tiempos, !is.na(spd)), aes(date_time, ht)) +
#geom_arrow(data =  tiempos1, aes(mag = spd, angle = di), color = "red") +
geom_arrow(aes(mag = spd, angle = di, color = spd)) +
geom_point(aes(size = ifelse(rmse1 > 0.5, rmse1, NA)), shape = 1, color = "black") +
geom_point(aes(size = ifelse(rmse2 > 0.5, rmse2, NA)), shape = 4, color = "grey25") +
scale_size_continuous(range = c(0, 5), guide = "none") +
scale_color_distiller(palette = "Oranges", name="Velocidad", direction = 1) +
xlab("Tiempo (hora UTC)") + ylab("Altura (km)") +
ylim(c(0,2)) +
scale_x_datetime(date_breaks = "2 hour", date_labels = "%H z") +
theme(axis.text.x = element_text(angle = 45)) +
labs(title = paste0("Dirección del viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
ggplot(subset(vad_20160114, hour(date_time) == 6), aes(ht, spd.smooth, color = minute(date_time))) + geom_line()
ggplot(subset(vad_20160114, hour(date_time) == 6), aes(ht, spd, color = minute(date_time))) + geom_line()
ggplot(subset(vad_20160114, hour(date_time) == 6), aes(ht, spd, color = factor(minute(date_time)))) + geom_line()
ggplot(subset(vad_20160114, hour(date_time) == 4, aes(ht, spd, color = factor(minute(date_time)))) + geom_line()
ggplot(subset(vad_20160114, hour(date_time) == 4), aes(ht, spd, color = factor(minute(date_time)))) + geom_line()
ggplot(subset(vad_20160114, hour(date_time) == 4), aes(ht, spd, color = factor(minute(date_time)))) + geom_line()  + scale_y_log10()
ggplot(subset(vad_20160114, hour(date_time) == 4), aes(ht, spd, color = factor(minute(date_time)))) + geom_line()  + scale_y_log10() + coord_flip()
ggplot(subset(vad_20160114, hour(date_time) == 4), aes(ht, spd, color = factor(minute(date_time)))) + geom_line()  + scale_x_log10() + coord_flip()
vad_20160113 <- read.vad("../../20160113_240/vda*")
vad_20160113 <- lowess.vad(vad_20160113)
dia <- vad_20160113
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
# geom_contour(data = vad_20160114, aes(z = spd)) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(data = subset(dia, rmse1 > 0.5), aes(size = rmse1), shape = 1, color = "black") +
geom_point(data = subset(dia, rmse2 > 0.5), aes(size = rmse2), shape = 4, color = "grey25") +
ylim(c(0,2)) + xlab("Tiempo") +
ylab("Altura (km)") +
labs(title = paste0("Campo de viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
View(superficie)
dia <- vad_20160114
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
# geom_contour(data = vad_20160114, aes(z = spd)) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(data = subset(dia, rmse1 > 0.5), aes(size = rmse1), shape = 1, color = "black") +
geom_point(data = subset(dia, rmse2 > 0.5), aes(size = rmse2), shape = 4, color = "grey25") +
ylim(c(0,2)) + xlab("Tiempo") +
ylab("Altura (km)") +
labs(title = paste0("Campo de viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
max(vad_20160114$spd)
max(vad_20160114$spd, na.rm = T)
which.max(vad_20160114$spd, na.rm = T)
which.max(vad_20160114$spd)
vad_20160114$date_time[which.max(vad_20160114$spd)]
vad_20160114$ht[which.max(vad_20160114$spd)]
t_i <- 27.7
t_f <- 22.3
p_i <- 1002.6
p_f <- 1003.3
u_max <- 16.51094
z_max <- 0.3
ri.j <- function(t_i, t_f, p_i, p_f, u_max, z_max){
g <- 9.8
tita_i <- t_i(p_i/1000)^(-0.286)
tita_f <- t_f(p_f/1000)^(-0.286)
tita_m <- (tita_i + tita_f)/2
delta_z <- z_max - 10
ri<- (g * (tita_f - tita_i)/delta_z) / (tita_m * (u_max/z_max)^2)
return(ri)
}
ri
ri.j(t_i, t_f, p_i, p_f, u_max, z_max)
ri.j <- function(t_i, t_f, p_i, p_f, u_max, z_max){
g <- 9.8
tita_i <- t_i*(p_i/1000)^(-0.286)
tita_f <- t_f*(p_f/1000)^(-0.286)
tita_m <- (tita_i + tita_f)/2
delta_z <- z_max - 10
ri<- (g * (tita_f - tita_i)/delta_z) / (tita_m * (u_max/z_max)^2)
return(ri)
}
ri.j(t_i, t_f, p_i, p_f, u_max, z_max)
tita_i <- t_i*(p_i/1000)^(-0.286)
tita_i
tita_f <- t_f*(p_f/1000)^(-0.286)
tita_f
tita_m <- (tita_i + tita_f)/2
tita_m
delta_z <- z_max - 10
delta_z
z_max
ri.j <- function(t_i, t_f, p_i, p_f, u_max, z_max){
g <- 9.8
tita_i <- t_i*(p_i/1000)^(-0.286)
tita_f <- t_f*(p_f/1000)^(-0.286)
tita_m <- (tita_i + tita_f)/2
delta_z <- z_max*1000 - 10
ri<- (g * (tita_f - tita_i)/delta_z) / (tita_m * (u_max/z_max)^2)
return(ri)
}
ri.j(t_i, t_f, p_i, p_f, u_max, z_max)
t_i <- 27.7+273.15
t_f <- 22.3+273.15
p_i <- 1002.6
p_f <- 1003.3
u_max <- 16.51094
z_max <- 0.3
ri.j <- function(t_i, t_f, p_i, p_f, u_max, z_max){
g <- 9.8
tita_i <- t_i*(p_i/1000)^(-0.286)
tita_f <- t_f*(p_f/1000)^(-0.286)
tita_m <- (tita_i + tita_f)/2
delta_z <- z_max*1000 - 10
ri<- (g * (tita_f - tita_i)/delta_z) / (tita_m * (u_max/z_max)^2)
return(ri)
}
ri.j(t_i, t_f, p_i, p_f, u_max, z_max)
tita_i <- t_i*(p_i/1000)^(-0.286)
tita_f <- t_f*(p_f/1000)^(-0.286)
tita_m <- (tita_i + tita_f)/2
delta_z <- z_max*1000 - 10
(tita_f-tita_i)/delta_z
(tita_f - tita_i)/delta_z)
(tita_f - tita_i)/delta_z
9.8*(tita_f - tita_i)/delta_z
ri.j <- function(t_i, t_f, p_i, p_f, u_max, z_max){
g <- 9.8
tita_i <- t_i*(p_i/1000)^(-0.286)
tita_f <- t_f*(p_f/1000)^(-0.286)
tita_m <- (tita_i + tita_f)/2
delta_z <- z_max*1000 - 10
ri<- (g * (tita_f - tita_i)/delta_z) / (tita_m * (u_max/z_max*1000)^2)
return(ri)
}
ri.j(t_i, t_f, p_i, p_f, u_max, z_max)
ri.j <- function(t_i, t_f, p_i, p_f, u_max, z_max){
g <- 9.8
tita_i <- t_i*(p_i/1000)^(-0.286)
tita_f <- t_f*(p_f/1000)^(-0.286)
tita_m <- (tita_i + tita_f)/2
delta_z <- z_max - 10
ri<- (g * (tita_f - tita_i)/delta_z) / (tita_m * (u_max/z_max)^2)
return(ri)
}
z_max <- 300
ri.j(t_i, t_f, p_i, p_f, u_max, z_max)
ri.j <- function(t_i, t_f, p_i, p_f, u_max, z_max){
g <- 9.8
tita_i <- t_i*(p_i/1000)^(-0.286)
tita_f <- t_f*(p_f/1000)^(-0.286)
tita_m <- (tita_i + tita_f)/2
delta_z <- z_max - 10
ri<- (g * (tita_i - tita_f)/delta_z) / (tita_m * (u_max/z_max)^2)
return(ri)
}
ri.j(t_i, t_f, p_i, p_f, u_max, z_max)
ri.j <- function(t_i, t_f, p_i, p_f, u_max, z_max){
g <- 9.8
tita_i <- t_i*(p_i/1000)^(-0.286)
tita_f <- t_f*(p_f/1000)^(-0.286)
tita_m <- (tita_i + tita_f)/2
delta_z <- z_max
ri<- (g * (tita_i - tita_f)/delta_z) / (tita_m * (u_max/z_max)^2)
return(ri)
}
ri.j(t_i, t_f, p_i, p_f, u_max, z_max)
ri.j <- function(t_i, t_f, p_i, p_f, u_max, z_max){
g <- 9.8
tita_i <- t_i*(p_i/1000)^(-0.286)
tita_f <- t_f*(p_f/1000)^(-0.286)
tita_m <- (tita_i + tita_f)/2
ri<- (g * (tita_i - tita_f)/z_max) / (tita_m * (u_max/z_max)^2)
return(ri)
}
ri.j(t_i, t_f, p_i, p_f, u_max, z_max)
vad_20160114 <- read.vad("../../20160114_240/vda*") %>% lowess.vad()
vad_20160113 <- read.vad("../../20160113_240/vda*") %>% lowess.vad()
dia <- rbind(vad_20160114, vad_20160113)
perfiles <- subset(dia, ht < 1.5 & minute(date_time) == 00 & hour(date_time) %in% c(0, 6, 12, 18, 23))
tiempos <- subset(dia, minute(date_time) == 0)
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
# geom_contour(data = vad_20160114, aes(z = spd)) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(data = subset(dia, rmse1 > 0.5), aes(size = rmse1), shape = 1, color = "black") +
geom_point(data = subset(dia, rmse2 > 0.5), aes(size = rmse2), shape = 4, color = "grey25") +
ylim(c(0,2)) + xlab("Tiempo") +
ylab("Altura (km)") +
labs(title = paste0("Campo de viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
ri_20160114 <- unique(vad_20160114$date_time)
ri_20160114 <- as.data.frame(unique(vad_20160114$date_time))
View(ri_20160114)
ri_20160114$u_max <- summarise(group_by(vad_20160114, minute(vad_20160114$date_time), vad_20160114$spd.smooth[which.max(vad_20160114$spd.smooth)])
)
ri_20160114$u_max <- summarise(group_by(vad_20160114, minute(vad_20160114$date_time), max(vad_20160114$spd.smooth)))
ri_20160114$u_max <- summarise(group_by(vad_20160114, hm(vad_20160114$date_time), max(vad_20160114$spd.smooth)))
View(vad_20160114)
summarise(group_by(vad_20160114, hour(vad_20160114$date_time), max(vad_20160114$spd.smooth)))
summarise(group_by(vad_20160114, hm(vad_20160114$date_time), max(vad_20160114$spd.smooth, na.rm = T)))
summarise(group_by(vad_20160114, minute(vad_20160114$date_time), max(vad_20160114$spd.smooth, na.rm = T)))
summarise(group_by(vad_20160114, hms(vad_20160114$date_time), max(vad_20160114$spd.smooth, na.rm = T)))
summarise(group_by(vad_20160114, date_time), max(vad_20160114$spd.smooth, na.rm = T))
summarise(group_by(vad_20160114, date_time), max(spd.smooth, na.rm = T))
vad_20160114 %>%
group_by(date_time) %>%
summarise(u_max = max(spd.smooth, na.rm = T))
ri_20160114 <- vad_20160114 %>%
group_by(date_time) %>%
summarise(u_max = max(spd.smooth, na.rm = T))
ri_20160114
ri_20160114 <- vad_20160114 %>%
group_by(date_time) %>%
summarise(u_max = max(spd.smooth, na.rm = T),
z_max = ht[which.max(spd.smooth)])
ri_20160114
View(ri_20160114)
day(sup$fecha == 14)
View(sup)
sup <- read.csv("../../Superficie/parana2016.csv", sep = ";", na.strings = " ")
sup$intensidad <- sup$intensidad * 0.5144 # Paso de nudos a m/s
sup$direccion <- sup$direccion * 10 #Paso del formato synop a angulos entre 0 y 360
sup$ht <- 0.01
sup$fecha <- dmy_hm(paste0(sup$fecha, " - ", sup$hora.utc, ":00"))
day(sup$fecha == 14)
str(sup)
day(sup$fecha) == 14
repeat(subset(sup, day(sup$fecha) ==14), 6)
repeat(subset(sup, day(sup$fecha) ==14), 6)
subset(sup, day(sup$fecha) ==14)
subset(sup, day(sup$fecha) ==14)$temp
repeat(subset(sup, day(sup$fecha) ==14)$temp, 6)
repeat(subset(sup, day(sup$fecha) ==14)$temp, 6)
rep(subset(sup, day(sup$fecha) ==14)$temp, 6)
rep(subset(sup, day(sup$fecha) ==14)$temp, each = 6)
sup %>%
subset(day(fecha) ==14)$temp %>%
rep(each = 6)
sup %>%
subset(day(fecha) ==14)
sup %>%
subset(day(fecha) ==14) %>%
.$temp
sup %>%
subset(day(fecha) ==14) %>%
.$temp %>%
rep(each = 6)
sup %>%
subset(day(fecha) ==14) %>%
.$presion_estacion %>%
rep(each = 6)
sup %>%
subset(day(fecha) ==14) %>%
.$temp %>%
rep(each = 6) %>%
+273
sup
head(dup)
head(sup)
head(ri_20160114)
temp_surf <- approxfun(sup$hora.utc, sup$temp)
temp_surf(ri_20160114$date_time[1])
temp_surf(ri_20160114$date_time[2])
temp_surf(ri_20160114$date_time[200])
temp_surf(ri_20160114$date_time)
str(sup)
temp_surf <- approxfun(sup$fecha, sup$temp)
temp_surf(ri_20160114$date_time)
plot(ri_20160114$date_time, temp_surf(ri_20160114$date_time))
points(sup$fecha, sup$temp)
plot(ri_20160114$date_time, temp_surf(ri_20160114$date_time), type = "l")
points(sup$fecha, sup$temp)
ri_20160114$t_f <- approx(sup$fecha, sup$temp, xout = ri_20160114$date_time)
approx(sup$fecha, sup$temp, xout = ri_20160114$date_time)
ri_20160114$t_f <- approx(sup$fecha, sup$temp, xout = ri_20160114$date_time)$y
ri_20160114$t_f <- approx(sup$fecha, sup$temp, xout = ri_20160114$date_time)$y +273
ri_20160114$p_f <- approx(sup$fecha, sup$presion_estacion, xout = ri_20160114$date_time)$y
ri.j <- function(t_i, t_f, p_i, p_f, u_max, z_max){
g <- 9.8
tita_i <- t_i*(p_i/1000)^(-0.286)
tita_f <- t_f*(p_f/1000)^(-0.286)
tita_m <- (tita_i + tita_f)/2
ri<- (g * (tita_i - tita_f)/z_max) / (tita_m * (u_max/z_max)^2)
return(ri)
}
ri_20160114 <- as.data.frame(unique(vad_20160114$date_time))
ri_20160114 <- vad_20160114 %>%
group_by(date_time) %>%
summarise(u_max = max(spd.smooth, na.rm = T),
z_max = ht[which.max(spd.smooth)])
ri_20160114$t_i <- 27.7+273.15
ri_20160114$p_i <- 1003.3
rep(subset(sup, day(sup$fecha) ==14)$temp, each = 6)
temp_surf <- approxfun(sup$hora.utc, sup$temp)
ri_20160114$t_f <- approx(sup$fecha, sup$temp, xout = ri_20160114$date_time)$y +273
ri_20160114$p_f <- approx(sup$fecha, sup$presion_estacion, xout = ri_20160114$date_time)$y
ri_20160114$ri <- with(ri_20160114, ri.j(t_i, t_f, p_i, p_f, u_max, z_max)
points(sup$fecha, sup$temp))
ri_20160114$ri <- with(ri_20160114, ri.j(t_i, t_f, p_i, p_f, u_max, z_max))
ri_20160114$ri <- with(ri_20160114, ri.j(t_i, t_f, p_i, p_f, u_max, z_max*1000))
plot(ri_20160114$date_time, ri_20160114$ri)
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
# geom_contour(data = vad_20160114, aes(z = spd)) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(data = subset(dia, rmse1 > 0.5), aes(size = rmse1), shape = 1, color = "black") +
geom_point(data = subset(dia, rmse2 > 0.5), aes(size = rmse2), shape = 4, color = "grey25") +
ylim(c(0,2)) + xlab("Tiempo") +
ylab("Altura (km)") +
labs(title = paste0("Campo de viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
plot(ri_20160114$date_time, ri_20160114$ri)
plot(ri_20160114$date_time, ri_20160114$u_max)
plot(ri_20160114$date_time, ri_20160114$u_max)
ggplot(ri_20160114, aes(date_time, ri)) +
geom_point()
ggplot(ri_20160114, aes(date_time, ri)) +
geom_point() +
geom_point(aes(y = u_max), color = "red")
ggplot(ri_20160114, aes(date_time, ri)) +
geom_point() +
geom_point(aes(y = u_max), color = "red") +
geom_point(aes(y = z_max), color = "blue")
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
# geom_contour(data = vad_20160114, aes(z = spd)) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(ri_20160114, aes(y = z_max), color = "blue") +
ylim(c(0,2)) + xlab("Tiempo") +
ylab("Altura (km)") +
labs(title = paste0("Campo de viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
# geom_contour(data = vad_20160114, aes(z = spd)) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(ri_20160114, aes(date_time, y = z_max), color = "blue") +
ylim(c(0,2)) + xlab("Tiempo") +
ylab("Altura (km)") +
labs(title = paste0("Campo de viento para el ", as.Date(dia$date_time[1]))) +
theme_minimal()
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(ri_20160114, aes(date_time, z_max), color = "blue") +
ggplot(ri_20160114, aes(date_time, ri)) +
geom_point() +
geom_point(aes(y = u_max), color = "red") +
geom_point(aes(y = z_max), color = "blue")
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(ri_20160114, aes(date_time, z_max), color = "blue")
ggplot(dia, aes(date_time, ht)) +
geom_contour(aes(z = spd, color = ..level..), binwidth = 1) +
scale_color_distiller(name = "Velocidad", type = "seq", palette = 8, direction = 1) +
geom_point(data = ri_20160114, aes(date_time, z_max), color = "blue")
